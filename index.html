<!doctype html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="node_modules/mdb-ui-kit/js/mdb.min.js" type="text/javascript"></script>

  <script src="js/jquery-3.3.1.min.js" type="text/javascript"></script>
  <script src="js/bootstrap.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
    <script src="js/script-tags.js"type="text/javascript"></script>

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
    integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <link rel="stylesheet" type="text/css" href="css/style-tags.scss">

  <script>



  </script>
<style>
  
</style>

</head>

<body id="content">
  <div class="sm-12 float-right">
    <img src="img/logo-lg-black.png" class="logo" alt="Canterbury Technical Institute">
  </div>
  <div class="sm-12 float-center"></div>
  <h1>Advanced Diploma of Information Technology</h1>
  </div>
  <div class="mt-4">
    <label for="formFileDisabled" class="form-label">Upload a new course content file </label>
    <input type="file" class="form-control" id="customFile" />
    
  </div>

  <ul class="accordion mt-4" id="accordion">

  </ul>

  <script>
    $(document).ready(function () {

      var course = {};
      course.units = {};
      course.JsonData = {};
      course.LoadCourseUnits = function () {
        $('#accordion').empty();

var test = `

<div class="col-sm-2">
                            <div class="row">
                              <div class="col-sm">
                                <i class="fas fa-tag"></i>
                                </div>
                                <div class="col-sm">
                                <i class="fas fa-trash-alt"></i>
                                </div>
                            </div>
                          </div>

`


        var content = course.JsonData.units.map(
          unit => {
            return `
              
                      <li id="${"head" + unit.code}">
                        <div class="row row-unit">
                          <a class="toggle col-sm-10" href="javascript:void(0);">${unit.name} (${unit.code}) (${Object.keys(unit.EPC).length})</a>
                          
                          
                        </div>
                        
                        <ul class="inner">
                            ${course.loadSubUnits(unit.EPC)}
                        </ul>
                      </li>
                      
                      `
          }
        );

        $('#accordion').append(content);

        prepareToggle();

      };


      course.loadSubUnits = function (unit_EPC) {
        var ret = "";

        for (var topic in unit_EPC) {
          ret += `
                  <li>
                    
                      <a href="#" class="toggle">  ${"#" + topic + " " + unit_EPC[topic].name}</a>
                    
                          <ul class="inner">
                              ${course.loadSubUniTopics(unit_EPC, topic)}
                          </ul>
                    </li> 
                `}
        return ret;

      };

      course.loadSubUniTopics = function (unit_EPC, topic) {

        var ret2 = "";
        for (var sub in unit_EPC[topic].pc) {
          ret2 += "<li>" + "#" + unit_EPC[topic].pc[sub].text + "</li>";
        }

        return ret2;
      };


      course.getJson = loadJSON(function (response) {
        course.JsonData = JSON.parse(response);

        course.LoadCourseUnits();

      });

      $('#customFile').on('change', handleFileSelect, false)

      document.getElementById('customFile').addEventListener('change', handleFileSelect, false);

      function handleFileSelect(event) {
        const reader = new FileReader()
        reader.onload = handleFileLoad;
        reader.readAsText(event.target.files[0])
      }

      function handleFileLoad(event) {

        course.JsonData = JSON.parse(event.target.result);

        course.LoadCourseUnits();

      }

    });



    function prepareToggle() {

      $('.toggle').click(function (e) {
        e.preventDefault();

        var $this = $(this);

        if ($this.parent().next().hasClass('show')) {
          $this.parent().next().removeClass('show');
          $this.parent().next().slideUp(350);
        } 
        else {
          $this.parent().find('li .inner').removeClass('show');
          $this.parent().find('li .inner').slideUp(350);
          $this.parent().next().toggleClass('show');
          $this.parent().next().slideToggle(350);
        }
      });
    }

    function loadJSON(callback) {

      var xobj = new XMLHttpRequest();
      xobj.overrideMimeType("application/json");
      xobj.open('GET', 'files/ICT60115.json', true); // Replace 'my_data' with the path to your file
      xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
          // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
          callback(xobj.responseText);
        }
      };
      xobj.send(null);
    }



  </script>
</body>
